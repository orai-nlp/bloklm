<div class="modal-overlay" *ngIf="isOpen" (click)="closeModal()" [class.uploading]="isUploading">
  <div class="modal-content" (click)="$event.stopPropagation()" [class.disabled]="isUploading">
    <!-- Loading overlay -->
    <div class="loading-overlay" *ngIf="isUploading">
      <div class="loading-spinner">
        <span class="material-icons spinning">refresh</span>
        <p class="loading-text">{{ i18n.translate('uploading') || 'Uploading files...' }}</p>
      </div>
    </div>

    <div class="modal-header">
      <div class="modal-title-section">
        <h2 class="section-title">{{ i18n.translate('addSources') }}</h2>
      </div>
      <button class="close-btn" (click)="closeModal()" [disabled]="isUploading">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <div class="modal-body">
      <p class="sources-description">
        {{ i18n.translate('modal_info') }}
      </p>
      
      <!-- File Upload Area -->
      <div class="upload-area" 
           [class.drag-over]="isDragOver"
           [class.disabled]="isUploading"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)"
           (click)="!isUploading && fileInput.click()">
        <div class="upload-icon">
          <span class="material-icons">cloud_upload</span>
        </div>
        <h4 class="upload-title">{{ i18n.translate('uploadSources') }}</h4>
        <p class="upload-description">
          {{ i18n.translate('dragDropOrChoose') }}
        </p>
        <p class="file-types">{{ i18n.translate('supported') }}: PDF, TXT, SRT, DOC, DOCX</p>
        
        <input #fileInput 
               type="file" 
               multiple 
               accept=".pdf,.txt,.md,.doc,.docx"
               (change)="onFileSelected($event)"
               [disabled]="isUploading"
               style="display: none;">
      </div>
      
      <!-- Paste Text Option -->
      <div class="paste-section" *ngIf="!showPasteArea">
        <div class="option-section" [class.disabled]="isUploading">
          <div class="option-header">
            <span class="material-icons">content_paste</span>
            <span class="option-title">{{ i18n.translate('pasteText') }}</span>
          </div>
          <div class="option-buttons">
            <button class="option-btn" 
                    (click)="showPasteTextArea()" 
                    [disabled]="isUploading">
              <span class="material-icons">content_copy</span>
              {{ i18n.translate('modal_paste_Clipboard') }}
            </button>
          </div>
        </div>
      </div>

      <!-- Paste Text Area -->
      <div class="paste-text-area" *ngIf="showPasteArea" [class.disabled]="isUploading">
        <div class="paste-header">
          <span class="material-icons">content_paste</span>
          <span class="paste-title">{{ i18n.translate('modal_paste_text') }}</span>
          <button class="cancel-paste-btn" (click)="cancelPaste()" [disabled]="isUploading">
            <span class="material-icons">close</span>
          </button>
        </div>
        <textarea 
          class="paste-textarea" 
          [(ngModel)]="pastedText"
          [placeholder]="placeholderText"
          [disabled]="isUploading"
          rows="6">
        </textarea>
        <div class="paste-actions">
          <input 
            type="text" 
            class="filename-input" 
            [(ngModel)]="pastedFileName"
            [placeholder]="placeholderText_docname"
            [disabled]="isUploading">
          <button class="add-paste-btn" 
                  [disabled]="!pastedText || !pastedFileName || isUploading"
                  (click)="addPastedText()">
            {{ i18n.translate('modal_addText') }}
          </button>
        </div>
      </div>
      
      <!-- Uploaded Files List -->
      <div class="uploaded-files" *ngIf="uploadedFiles.length > 0">
        <h4 class="files-title">{{ i18n.translate('modal_filesToUp') }} ({{ uploadedFiles.length }})</h4>
        <div class="file-list" [class.disabled]="isUploading">
          <div class="file-item" *ngFor="let file of uploadedFiles; let i = index">
            <div class="file-info">
              <span class="material-icons file-icon">
                {{ getFileIcon(file.type) }}
              </span>
              <div class="file-details">
                <span class="file-name">{{ file.name }}</span>
                <span class="file-size">{{ formatFileSize(file.size) }}</span>
              </div>
            </div>
            <button class="remove-file-btn" 
                    (click)="removeFile(i)" 
                    [disabled]="isUploading">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Source Limit Info -->
      <div class="source-limit">
        <span class="material-icons">info</span>
        <span class="limit-text">{{ i18n.translate('sourceLimit') }}</span>
        <span class="limit-count">{{ uploadedFiles.length }} / 50</span>
      </div>

      <!-- Upload Button -->
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModal()" [disabled]="isUploading">
          Cancel
        </button>
        <button class="upload-btn" 
                [disabled]="uploadedFiles.length === 0 || isUploading"
                [class.loading]="isUploading"
                (click)="uploadFiles()">
          <span class="material-icons upload-icon" *ngIf="!isUploading">upload</span>
          <span class="material-icons loading-icon spinning" *ngIf="isUploading">refresh</span>
          {{ isUploading ? (i18n.translate('uploading') || 'Uploading...') : (i18n.translate('modal_upload_files') || 'Upload Files') }} 
          <span *ngIf="!isUploading">({{ uploadedFiles.length }})</span>
        </button>
      </div>
    </div>
  </div>
</div>