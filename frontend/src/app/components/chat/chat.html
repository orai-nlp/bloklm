<!-- Confirmation Modal -->
<div 
  class="modal-overlay" 
  [class.active]="showConfirmationModal"
  (click)="$event.target === $event.currentTarget && hideConfirmModal()">
    <div class="modal">
        <div class="modal-title">Clear All Data</div>
        <div class="modal-content">
            Are you sure you want to clear all chat history and settings? This action cannot be undone.
        </div>
        <div class="modal-actions">
            <button class="modal-btn modal-btn-cancel" (click)="hideConfirmModal()">Cancel</button>
            <button class="modal-btn modal-btn-confirm" (click)="clearAllData()">Clear Data</button>
        </div>
    </div>
</div>

<div class="app-container">
     <!-- <div class="sidebar">
       <button class="new-chat" (click)="createNewChat()">
            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="24" width="24" xmlns="http://www.w3.org/2000/svg">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New chat
        </button> 
        
         Theme Switcher 
        <div class="theme-switcher">
            <label for="theme-select">Theme</label>
            <select 
              id="theme-select" 
              [value]="currentTheme" 
              (change)="onThemeChange($event)">
                <option *ngFor="let option of themeOptions" [value]="option.value">
                  {{ option.label }}
                </option>
            </select>
        </div>
        
        <div class="history-container">
            <div 
              *ngFor="let chat of chatHistory" 
              class="chat-history-item"
              (click)="loadChat(chat.id)">
                {{ chat.title }}
            </div>
        </div>
        
        <div class="sidebar-footer">
            <div>Local LLM Chat Interface</div>
            <button class="clear-storage-btn" (click)="showConfirmModal()">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="16" width="16" xmlns="http://www.w3.org/2000/svg">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2 2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
                Clear All Data
            </button>
        </div>
    </div>
    -->
    <div class="main">
        <!-- Add template reference variable here -->
        <div class="chat-container" #chatContainer>
            <div class="welcome-screen" *ngIf="showWelcomeScreen">
                <h1>Welcome to your Local LLM</h1>
                <p>This is a simple interface for interacting with your local language model. Type a message below to start a conversation.</p>
            </div>
            
            <!-- Messages -->
            <div *ngFor="let message of getDisplayMessages()" 
                 class="message"
                 [class.user-message]="message.role === 'user'"
                 [class.ai-message]="message.role === 'assistant'">
                
                <div class="avatar"
                     [class.user-avatar]="message.role === 'user'"
                     [class.ai-avatar]="message.role === 'assistant'">
                    <!-- User icon -->
                    <svg *ngIf="message.role === 'user'" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="24" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <!-- AI icon -->
                    <svg *ngIf="message.role === 'assistant'" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="24" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 16c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"></path>
                    </svg>
                </div>
                
                <div class="message-content markdown" [innerHTML]="formatMarkdown(message.content)">
                </div>
            </div>
            
            <!-- Typing indicator -->
            <div *ngIf="showTypingIndicator" class="message ai-message">
                <div class="avatar ai-avatar">
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="24" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 16c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"></path>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        Thinking<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Input Area -->
        <div class="input-area">

            <!-- <div class="left-input">
                <button
                    class="clear-storage-btn"
                    (click)="showConfirmModal()"
                    title="Clear Chat">
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="16" width="16" xmlns="http://www.w3.org/2000/svg">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2 2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
            </div> -->


            <div class="input-container">
                <button
                    class="clear-storage-btn"
                    (click)="showConfirmModal()"
                    title="Clear Chat">
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="16" width="16" xmlns="http://www.w3.org/2000/svg">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2 2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
                <textarea 
                  #userInput
                  [(ngModel)]="userInputValue"
                  (input)="onInputChange()"
                  (keydown)="onKeyDown($event)"
                  placeholder="Type a message..." 
                  rows="1">
                </textarea>
                <button 
                  class="send-button" 
                  [disabled]="!canSend"
                  (click)="sendMessage()">
                    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>